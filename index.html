<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>æ³¨æ–‡å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
<script src="https://yubinbango.github.io/yubinbango/yubinbango.js" charset="UTF-8"></script>
<style>
  :root{
    --blue:#0055a4; --blue-dark:#003d7a; --bg:#f5f7fa; --card:#fff; --text:#1a1a1a;
    --border:#dce1e8; --red:#c62828; --green:#2e7d32;
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;padding-bottom:92px}

  .hero{background:linear-gradient(160deg,var(--blue) 0%,var(--blue-dark) 100%);color:#fff;padding:22px 16px;text-align:center}
  .hero h1{font-size:1.35rem;margin:0;font-weight:800;letter-spacing:.02em}

  .progress-bar{display:flex;gap:4px;padding:14px 16px;max-width:520px;margin:0 auto}
  .progress-step{flex:1;height:4px;background:var(--border);border-radius:2px}
  .progress-step.active{background:var(--blue)}
  .progress-step.done{background:var(--green)}

  .container{max-width:520px;margin:0 auto;padding:0 16px}
  .step{display:none;animation:fadeIn .25s ease}
  .step.active{display:block}
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

  .card{background:var(--card);border-radius:14px;padding:18px;margin-bottom:14px;border:1px solid var(--border);box-shadow:0 2px 8px rgba(0,0,0,.06)}
  .card-title{font-weight:800;color:var(--blue);margin-bottom:12px;border-bottom:1px solid #eee;padding-bottom:10px}

  .field{margin-bottom:16px}
  .field label{display:block;font-weight:700;font-size:.92rem;margin-bottom:6px}
  
  .field input:not([type="checkbox"]):not([type="radio"]),
  .field select,
  .field textarea{
    width:100%; padding:12px; border:2px solid var(--border); border-radius:10px; font-size:1rem;
    -webkit-appearance:none; background:#fff; outline:none;
  }
  .field textarea{resize:vertical}
  .field-hint{font-size:.78rem;color:#5f6368;margin-top:6px}
  .error-msg{color:var(--red);font-size:.82rem;display:none;margin-top:6px;font-weight:800}
  .field.error input:not([type="checkbox"]):not([type="radio"]),
  .field.error select,
  .field.error textarea{border-color:var(--red);background:#fff8f8}
  .field.error .error-msg{display:block}

  .case-id-group{display:flex;gap:8px}
  .case-id-group select{width:36%}
  .case-id-group input{width:64%}

  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px}

  .choice{
    border:2px solid var(--border); border-radius:10px; padding:12px 8px; text-align:center;
    font-size:.92rem; font-weight:800; cursor:pointer; background:#fff; transition:.15s;
    display:flex; align-items:center; justify-content:center; min-height:52px; user-select:none;
  }
  .choice input{display:none}
  .choice.selected{border-color:var(--blue); background:#e8f2fc; color:var(--blue)}

  /* ä¿®ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
  #repair_options_area{margin-top:12px;display:none}
  .repair-item-row{
    display:flex;justify-content:space-between;align-items:center;background:#fff;border:1px solid var(--border);
    border-radius:10px;padding:10px;margin-bottom:8px;gap:10px
  }
  .repair-item-row.active{border-color:var(--blue); background:#f0f8ff}
  .repair-info{font-size:.9rem;font-weight:800;flex:1}
  .repair-info small{font-weight:700;color:#666}
  .counter-ui{display:flex;align-items:center;gap:8px}
  .btn-circle{
    width:34px;height:34px;border-radius:50%;border:1px solid #ccc;background:#fff;cursor:pointer;
    font-size:1.2rem;display:flex;align-items:center;justify-content:center
  }
  .count-num{font-weight:900;width:22px;text-align:center}

  .extra-box{
    margin-top:10px;padding:12px;background:#fffdf3;border:1px solid #ffe0a3;border-radius:10px
  }
  .extra-row{
    display:flex;align-items:center;gap:10px;padding:10px;border:1px dashed #ffd48a;border-radius:10px;
    background:#fff; margin-top:8px
  }
  .extra-row input[type="checkbox"]{
    width:22px;height:22px; -webkit-appearance:auto; appearance:auto;
    transform:none;
  }
  .extra-row .txt{font-weight:800}
  .extra-row .sub{font-size:.8rem;color:#666;margin-left:auto}

  .discount-box{margin-top:12px;padding:12px;background:#fff3e0;border:1px solid #ffcc80;border-radius:10px}
  .btn-apply{background:#e65100;color:#fff;border:none;padding:7px 12px;border-radius:8px;font-weight:900;cursor:pointer}
  .coupon-success{color:var(--green)}
  .coupon-error{color:var(--red)}

  .confirm-row{display:flex;border-bottom:1px solid #eee;padding:9px 0;font-size:.92rem;gap:10px}
  .confirm-label{width:110px;color:#666;font-weight:700}
  .confirm-val{flex:1;font-weight:800}

  .agreement-section{background:#fff;border:2px solid #e0e0e0;border-radius:12px;padding:14px;margin-top:14px}
  .consent-copy-box{
    background:#e3f2fd;padding:10px;border-radius:10px;border:1px solid #90caf9;
    font-weight:900;color:#0d47a1;text-align:center;margin:10px 0;user-select:all
  }

  /* ç´„æ¬¾è¡¨ç¤ºã‚¨ãƒªã‚¢ */
  .terms-box {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 16px;
    font-size: 0.92rem;
    line-height: 1.7;
    height: 400px;
    overflow-y: scroll;
    margin-bottom: 16px;
  }
  .terms-box ul { padding-left: 1.4em; margin: 0; }
  .terms-box li { margin-bottom: 0.8em; }

  .big-check{
    display:flex;align-items:center;gap:10px;padding:12px;border-radius:12px;border:2px dashed #ddd;background:#fff
  }
  .big-check input[type="checkbox"]{
    width:22px;height:22px; -webkit-appearance:auto; appearance:auto;
    transform:none;
  }
  .big-check .t{font-weight:900;color:var(--red)}
  .big-check .s{font-size:.82rem;color:#666;font-weight:700}

  .bottom-nav{
    position:fixed;bottom:0;left:0;right:0;background:#fff;padding:14px;display:flex;gap:10px;
    box-shadow:0 -2px 12px rgba(0,0,0,.08);z-index:100
  }
  .btn{flex:1;padding:12px;border-radius:10px;font-weight:900;border:none;cursor:pointer;text-align:center;font-size:1rem}
  .btn-next{background:var(--blue);color:#fff}
  .btn-back{background:#eee;color:#555}
  .btn:disabled{opacity:.55;cursor:not-allowed}

  .complete-screen{text-align:center;padding:36px 16px}
  .complete-icon{font-size:3rem;margin-bottom:8px}
</style>
</head>

<body>
  <form class="h-adr">
  <span class="p-country-name" style="display:none;">Japan</span>

  <div class="hero"><h1>æ³¨æ–‡å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </h1></div>

  <div class="progress-bar">
    <div class="progress-step active" id="p1"></div>
    <div class="progress-step" id="p2"></div>
    <div class="progress-step" id="p3"></div>
    <div class="progress-step" id="p4"></div>
    <div class="progress-step" id="p5"></div>
    <div class="progress-step" id="p6"></div>
  </div>

  <div class="container">

    <div class="step active" id="step1">
      <div class="card">
        <div class="card-title">ğŸ“ æ¡ˆä»¶ç®¡ç†ï¼ˆå¿…é ˆï¼‰</div>

        <div class="field" id="f_case">
          <label>æ¡ˆä»¶ç•ªå· <span style="color:var(--red);font-weight:900;">â€»å¿…é ˆ</span></label>
          <div class="case-id-group">
            <select id="c_case_prefix">
              <option value="YA">YA</option>
              <option value="HM">HM</option>
              <option value="CP">CP</option>
            </select>
            <input type="number" id="c_case_num" placeholder="ç•ªå·ï¼ˆä¾‹ï¼š1234ï¼‰" inputmode="numeric" />
          </div>
          <div class="error-msg">æ¡ˆä»¶ç•ªå·ï¼ˆç•ªå·ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="field" id="f_emp">
          <label>æ‹…å½“ID <span style="color:var(--red);font-weight:900;">â€»å¿…é ˆ</span></label>
          <input type="text" id="c_emp_id" placeholder="ä¾‹ï¼š1001" />
          <div class="error-msg">æ‹…å½“IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="card-title" style="margin-top:16px;">ğŸ‘¤ ãŠå®¢æ§˜æƒ…å ±ï¼ˆå¿…é ˆï¼‰</div>

        <div class="field" id="f_name">
          <label>ãŠåå‰ <span style="color:var(--red);font-weight:900;">â€»å¿…é ˆ</span></label>
          <input type="text" id="c_name" />
          <div class="error-msg">ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="field">
          <label>ãƒ•ãƒªã‚¬ãƒŠï¼ˆä»»æ„ï¼‰</label>
          <input type="text" id="c_kana" placeholder="ä¾‹ï¼šãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦" />
        </div>

        <div class="field" id="f_tel">
          <label>é›»è©±ç•ªå· <span style="color:var(--red);font-weight:900;">â€»å¿…é ˆ</span></label>
          <input type="tel" id="c_tel" placeholder="ä¾‹ï¼š09012345678" inputmode="tel" />
          <div class="error-msg">é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="field" id="f_email">
          <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span style="color:var(--red);font-weight:900;">â€»å¿…é ˆ</span></label>
          <input type="email" id="c_email" placeholder="ä¾‹ï¼šxxx@example.com" inputmode="email" />
          <div class="error-msg">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="field" id="f_zip">
          <label>éƒµä¾¿ç•ªå· <span style="color:var(--red);font-weight:900;">â€»å¿…é ˆ</span></label>
          <input type="tel" id="c_zip" class="p-postal-code" maxlength="8" placeholder="ä¾‹ï¼š1760001" inputmode="numeric" />
          <div class="field-hint">â€»ãƒã‚¤ãƒ•ãƒ³ç„¡ã—ã§å…¥åŠ›ã™ã‚‹ã¨ä½æ‰€ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™</div>
          <div class="error-msg">éƒµä¾¿ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="field" id="f_addr">
          <label>ã”ä½æ‰€ <span style="color:var(--red);font-weight:900;">â€»å¿…é ˆ</span></label>
          <input type="text" id="c_address" class="p-region p-locality p-street-address" placeholder="ä¾‹ï¼šæ±äº¬éƒ½ç·´é¦¬åŒº..." />
          <div class="error-msg">ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="field">
          <label>å»ºç‰©åï¼ˆä»»æ„ï¼‰</label>
          <input type="text" id="c_building" placeholder="ä¾‹ï¼šâ—¯â—¯ãƒãƒ³ã‚·ãƒ§ãƒ³101" />
        </div>
      </div>
    </div>

    <div class="step" id="step2">
      <div class="card">
        <div class="card-title">ğŸ“„ ä½œæ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ç´„æ¬¾ï¼ˆå…¨æ–‡ï¼‰</div>
        <p style="font-size:.9rem; color:#666; margin-bottom:10px;">
          ä»¥ä¸‹ã®å†…å®¹ã‚’å¿…ãšã”ç¢ºèªã„ãŸã ãã€åŒæ„ã®ä¸Šã§æ¬¡ã¸ãŠé€²ã¿ãã ã•ã„ã€‚
        </p>

        <div class="terms-box">
          <ul>
            <li><strong>ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã®åˆæ„</strong><br>ãŠå®¢æ§˜ã¯ã€ä½œæ¥­å“¡ã‹ã‚‰æç¤ºã•ã‚ŒãŸä½œæ¥­å†…å®¹ãŠã‚ˆã³ã‚µãƒ¼ãƒ“ã‚¹èª¬æ˜ã‚’å—ã‘ã€æœ¬ç´„æ¬¾ãŠã‚ˆã³åˆ¥é€”æç¤ºã•ã‚Œã‚‹è¦‹ç©æ›¸ã®å†…å®¹ã«åŒæ„ã—ãŸä¸Šã§ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç™ºæ³¨ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>
            
            <li><strong>æå®³è³ å„Ÿã®ç¯„å›²</strong><br>å½“ç¤¾ã®æ–½å·¥ä¸Šã®ç‘•ç–µï¼ˆãƒŸã‚¹ï¼‰ã«ã‚ˆã‚ŠãŠå®¢æ§˜ã«æå®³ãŒç”Ÿã˜ãŸå ´åˆã€å½“ç¤¾ãŒè² æ‹…ã™ã‚‹æå®³è³ å„Ÿã®é¡ã¯ã€å½“è©²ä½œæ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®æ–™é‡‘é¡ã‚’ä¸Šé™ã¨ã—ã¾ã™ã€‚ã“ã‚Œã‚’è¶…ãˆã‚‹ç¯„å›²ã®è³ å„Ÿè²¬ä»»ã¯è² ã„ã‹ã­ã¾ã™ã€‚</li>
            
            <li><strong>æ–™é‡‘ã«é–¢ã™ã‚‹åˆæ„</strong><br>äºˆç´„æ™‚ã«ãŠä¼ãˆã—ãŸæ¦‚ç®—é‡‘é¡ã¨ã€ç¾å ´çŠ¶æ³ã«ã‚ˆã‚Šç®—å‡ºã•ã‚ŒãŸç¢ºå®šé‡‘é¡ã«ç›¸é•ãŒç™ºç”Ÿã—ãŸå ´åˆã€ç¾å ´ã«ã¦æ¡ˆå†…ã—ãŸæœ€çµ‚çš„ãªæ–™é‡‘ã«åŒæ„ã—ã€ç™ºæ³¨ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>
            
            <li><strong>å€‹äººæƒ…å ±ã®å–æ‰±ã„</strong><br>è£é¢ï¼ˆã¾ãŸã¯åˆ¥é€”æç¤ºï¼‰ã®ã€Œå€‹äººæƒ…å ±ã®å–æ‰±ã„ã«ã¤ã„ã¦ã€ã‚’ç¢ºèªã—ã€åé›†ã•ã‚ŒãŸå€‹äººæƒ…å ±ãŒæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ãŠã‚ˆã³é–¢é€£æ¥­å‹™ã®ãŸã‚ã«åˆ©ç”¨ã•ã‚Œã‚‹ã“ã¨ã«åŒæ„ã—ã¾ã™ã€‚</li>
            
            <li><strong>ä½œæ¥­å®Œäº†ã®ç¢ºèª</strong><br>ä½œæ¥­çµ‚äº†å¾Œã€ãŠå®¢æ§˜ã¯ä½œæ¥­ç®‡æ‰€ãŠã‚ˆã³å‹•ä½œã‚’ç¢ºèªã—ã€ä½œæ¥­ãŒå®Œäº†ã—ãŸã“ã¨ã‚’èªã‚ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>
            
            <li><strong>å»ƒæ£„ç‰©ã®å‡¦ç†</strong><br>æœ¬ä½œæ¥­ã«ä¼´ã„ç™ºç”Ÿã—ãŸäº¤æ›æ¸ˆã¿ã®è£½å“ã€éƒ¨å“ã€æ¢±åŒ…æç­‰ã¯ã€æ–½å·¥ä¼šç¤¾ãŒå›åã—ã€é©åˆ‡ã«å»ƒæ£„å‡¦ç†ã™ã‚‹ã“ã¨ã«äº†æ‰¿ã—ã¾ã™ã€‚</li>
          </ul>
        </div>

        <div class="field">
          <label class="big-check" style="border-color:var(--blue); background:#e3f2fd;">
            <input type="checkbox" id="agree_terms_check" />
            <div class="t" style="color:var(--blue)">ç´„æ¬¾ã®å†…å®¹ã‚’ç¢ºèªã—ã€åŒæ„ã—ã¾ã™</div>
          </label>
        </div>
      </div>
    </div>

    <div class="step" id="step3">
      <div class="card">
        <div class="card-title">ğŸ”§ å¯¾è±¡æ©Ÿå™¨ãƒ»ç—‡çŠ¶</div>

        <div class="field">
          <label>å¯¾è±¡æ©Ÿå™¨</label>
          <select id="c_equipment">
            <option value="ãƒ«ãƒ¼ãƒ ã‚¨ã‚¢ã‚³ãƒ³">ãƒ«ãƒ¼ãƒ ã‚¨ã‚¢ã‚³ãƒ³</option>
            <option value="æ¥­å‹™ç”¨ã‚¨ã‚¢ã‚³ãƒ³">æ¥­å‹™ç”¨ã‚¨ã‚¢ã‚³ãƒ³</option>
            <option value="ã‚¨ã‚³ã‚­ãƒ¥ãƒ¼ãƒˆ">ã‚¨ã‚³ã‚­ãƒ¥ãƒ¼ãƒˆ</option>
            <option value="ã‚¬ã‚¹çµ¦æ¹¯å™¨">ã‚¬ã‚¹çµ¦æ¹¯å™¨</option>
          </select>
        </div>

        <div class="field">
          <label>ç—‡çŠ¶ï¼ˆè¤‡æ•°é¸æŠOKï¼‰</label>
          <div class="grid-2" id="symptomGrid">
            <label class="choice"><input type="checkbox" name="symptom" value="å†·ãˆãªã„" />å†·ãˆãªã„</label>
            <label class="choice"><input type="checkbox" name="symptom" value="æ°´æ¼ã‚Œ" />æ°´æ¼ã‚Œ</label>
            <label class="choice"><input type="checkbox" name="symptom" value="é›»æºå…¥ã‚‰ãš" />é›»æºå…¥ã‚‰ãš</label>
            <label class="choice"><input type="checkbox" name="symptom" value="ç•°éŸ³ãƒ»è‡­ã„" />ç•°éŸ³ãƒ»è‡­ã„</label>
            <label class="choice"><input type="checkbox" name="symptom" value="ç‚¹æ»…" />ç‚¹æ»…</label>
            <label class="choice"><input type="checkbox" name="symptom" value="ãã®ä»–" />ãã®ä»–</label>
          </div>
          <div class="field-hint">â€»ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯ã€Œè¡¨ç¤ºã—ãªã„ã€ãƒ‡ã‚¶ã‚¤ãƒ³ã§ã™ï¼ˆã‚¿ãƒƒãƒ—ã§é¸æŠã§ãã¾ã™ï¼‰</div>
        </div>

        <div class="field">
          <label>è©³ç´°ï¼ˆä»»æ„ï¼‰</label>
          <textarea id="c_detail" style="height:72px" placeholder="ä¾‹ï¼šå®¤å¤–æ©ŸãŒæ­¢ã¾ã‚‹ã€ç•°éŸ³ãŒã™ã‚‹ç­‰"></textarea>
        </div>
      </div>
    </div>

    <div class="step" id="step4">
      <div class="card">
        <div class="card-title">ğŸ“‹ ä½œæ¥­å†…å®¹</div>

        <div class="field">
          <label>ä½œæ¥­ç¨®åˆ¥</label>
          <div class="grid-2" id="orderTypeGrid">
            <label class="choice selected">
              <input type="radio" name="order_type" value="åŸå› ç©¶æ˜ä½œæ¥­" checked />
              æ•…éšœè¨ºæ–­è²»ç”¨(åŸå› ç©¶æ˜ä½œæ¥­)
            </label>
            <label class="choice">
              <input type="radio" name="order_type" value="ä¿®ç†" />
              ä¿®ç†
            </label>
          </div>

          <div id="repair_options_area">
            <div class="field-hint" style="margin-top:10px;color:#c62828;font-weight:900;">
              â€»ä¾¡æ ¼ã¯ç¨è¾¼ï¼ˆ2026å¹´æ”¹è¨‚ç‰ˆãƒ™ãƒ¼ã‚¹ï¼‰ï¼ã€Œåˆ¥é€”è¦‹ç©ã€ã¯é‡‘é¡ã«åŠ ç®—ã•ã‚Œã¾ã›ã‚“
            </div>

            <div class="repair-item-row" data-price="29700" data-name="å†·åª’ã‚¬ã‚¹æ³¨å…¥ï¼ˆ500gã¾ã§ï¼‰">
              <div class="repair-info">å†·åª’ã‚¬ã‚¹æ³¨å…¥ï¼ˆ500gã¾ã§ï¼‰<br><small>29,700å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="3300" data-name="å†·åª’ã‚¬ã‚¹è¿½åŠ ï¼ˆ100gã¾ã§ï¼‰">
              <div class="repair-info">å†·åª’ã‚¬ã‚¹è¿½åŠ ï¼ˆ100gã¾ã§ï¼‰<br><small>3,300å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="17600" data-name="çœŸç©ºå¼•ã">
              <div class="repair-info">çœŸç©ºå¼•ã<br><small>17,600å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>
            
            <div class="repair-item-row" data-price="17600" data-name="ãƒ•ãƒ¬ã‚¢åŠ å·¥ãƒ»ãƒãƒ«ãƒ–ã‚³ã‚¢äº¤æ›">
              <div class="repair-info">ãƒ•ãƒ¬ã‚¢åŠ å·¥ãƒ»ãƒãƒ«ãƒ–ã‚³ã‚¢äº¤æ›<br><small>17,600å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="28600" data-name="æ°´æ¼ã‚Œä¿®å¾©å·¥è³ƒ">
              <div class="repair-info">æ°´æ¼ã‚Œä¿®å¾©å·¥è³ƒ<br><small>28,600å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="26400" data-name="å››æ–¹å¼å‹•ä½œä¸è‰¯è§£æ¶ˆå·¥è³ƒ">
              <div class="repair-info">å››æ–¹å¼å‹•ä½œä¸è‰¯è§£æ¶ˆå·¥è³ƒ<br><small>26,400å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="26400" data-name="é›»æºéƒ¨å†æ¥ç¶šä½œæ¥­">
              <div class="repair-info">é›»æºéƒ¨å†æ¥ç¶šä½œæ¥­<br><small>26,400å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="28600" data-name="ã‚¨ã‚¢ã‚³ãƒ³å–ã‚Šä»˜ã‘ï¼ˆæ¨™æº–å·¥äº‹ï¼‰">
              <div class="repair-info">ã‚¨ã‚¢ã‚³ãƒ³å–ã‚Šä»˜ã‘ï¼ˆæ¨™æº–å·¥äº‹ï¼‰<br><small>28,600å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="7700" data-name="å†·åª’ç®¡å»¶é•·ï¼ˆ1mæ¯ï¼‰">
              <div class="repair-info">å†·åª’ç®¡å»¶é•·ï¼ˆ1mæ¯ï¼‰<br><small>7,700å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="8800" data-name="ã‚¨ã‚¢ã‚³ãƒ³å–ã‚Šå¤–ã—å·¥è³ƒ">
              <div class="repair-info">ã‚¨ã‚¢ã‚³ãƒ³å–ã‚Šå¤–ã—å·¥è³ƒ<br><small>8,800å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="26400" data-name="ç©´é–‹ã‘å·¥è³ƒ">
              <div class="repair-info">ç©´é–‹ã‘å·¥è³ƒ<br><small>26,400å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="repair-item-row" data-price="26400" data-name="éƒ¨å“äº¤æ›/èª¿æ•´ï¼ˆç›®å®‰ï¼‰">
              <div class="repair-info">éƒ¨å“äº¤æ›/èª¿æ•´ï¼ˆç›®å®‰ï¼‰<br><small>26,400å††</small></div>
              <div class="counter-ui">
                <button class="btn-circle" type="button" onclick="changeCount(this,-1)">-</button>
                <span class="count-num">0</span>
                <button class="btn-circle" type="button" onclick="changeCount(this,1)">+</button>
              </div>
            </div>

            <div class="extra-box">
              <div style="font-weight:900;color:#8a4b00;">åˆ¥é€”è¦‹ç©ï¼ˆã“ã®ãƒ•ã‚©ãƒ¼ãƒ ã§ã¯é‡‘é¡ã«åŠ ç®—ã—ã¾ã›ã‚“ï¼‰</div>
              <label class="extra-row">
                <input type="checkbox" id="extra_relocate" />
                <span class="txt">ç§»è¨­è²»ç”¨</span>
                <span class="sub">åˆ¥é€”è²»ç”¨</span>
              </label>
              <label class="extra-row">
                <input type="checkbox" id="extra_hanging" />
                <span class="txt">å®¤å¤–æ©Ÿå¤©åŠã‚Š</span>
                <span class="sub">åˆ¥é€”è²»ç”¨</span>
              </label>
            </div>
          </div>
        </div>

        <div class="discount-box">
          <div style="display:flex; gap:10px;">
            <input type="text" id="c_coupon_code" placeholder="ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰" style="flex:1; padding:10px;" />
            <button type="button" class="btn-apply" onclick="applyCoupon()">é©ç”¨</button>
          </div>
          <div id="coupon_result" style="font-size:.85rem; margin-top:6px; font-weight:900;"></div>
        </div>

        <div class="field" style="margin-top:16px;">
          <label>ãŠæ”¯æ‰•ã„æ–¹æ³•</label>
          <div class="grid-3" id="paymentGrid">
            <label class="choice selected"><input type="radio" name="payment_method" value="ç¾é‡‘" checked />ç¾é‡‘</label>
            <label class="choice"><input type="radio" name="payment_method" value="ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰" />ã‚«ãƒ¼ãƒ‰</label>
            <label class="choice"><input type="radio" name="payment_method" value="ã”ç›¸è«‡" />ã”ç›¸è«‡</label>
          </div>
        </div>
      </div>
    </div>

    <div class="step" id="step5">
      <div class="card">
        <div class="card-title">âœ… å…¥åŠ›å†…å®¹ã®ç¢ºèª</div>
        <div id="confirmContent"></div>
      </div>
    </div>

    <div class="step" id="step6">
      <div class="card">
        <div class="card-title">ğŸ§¾ å¥‘ç´„ãƒ»æ‰¿è«¾ <span style="color:var(--red); font-size:.85em;">(é‡è¦)</span></div>

        <div class="field" style="background:#f9f9f9; padding:14px; border-radius:12px;">
          <label id="fee_label">è²»ç”¨ï¼ˆç¨è¾¼ï¼‰</label>
          <input type="text" id="fee_diagnosis" readonly style="font-weight:900; color:var(--blue); font-size:1.35rem; background:#fff; border:none;" />
          <div class="field-hint">â€»ä¿®ç†ã¯ã€Œãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆè¨ˆï¼ˆåˆ¥é€”è²»ç”¨ã¯å«ã¾ãšï¼‰ã€ã€åŸå› ç©¶æ˜ã¯å®šé¡ã§ã™</div>
        </div>

        <div class="field">
          <label>ã‚­ãƒ£ãƒ³ã‚»ãƒ«è¦å®š</label>
          <textarea id="cancel_rule" readonly style="height:70px; font-size:.9rem; background:#eee;">ãŠç”³è¾¼ã¿å¾Œã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«è²»ç”¨ã¯100%ã‚’ç”³ã—å—ã‘ã¾ã™ã€‚</textarea>
        </div>

        <div class="field" style="margin-top:12px;">
          <label class="big-check">
            <input type="checkbox" id="req_sameday" />
            <div>
              <div class="t">ç·Šæ€¥äº‹æ…‹ã«ã¤ãå½“æ—¥å·¥äº‹ã‚’å¸Œæœ›ã™ã‚‹</div>
              <div class="s">â€»çŠ¶æ³ã«ã‚ˆã‚Šå¯¾å¿œã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™</div>
            </div>
          </label>
        </div>

        <div class="agreement-section">
          <label style="color:var(--blue); margin-bottom:10px;">
            ã€é›»å­äº¤ä»˜ã¸ã®æ‰¿è«¾ã€‘<span style="color:var(--red); font-size:.85rem;">â€»å¿…é ˆ</span>
          </label>

          <p style="font-size:.9rem; margin-bottom:10px;">
            ä¸‹ã®é’æ ã®æ–‡ç« ã‚’ã€å…¥åŠ›æ¬„ã«<strong>ä¸€å­—ä¸€å¥åŒã˜ã‚ˆã†ã«</strong>å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
            ã“ã‚Œã«ã‚ˆã‚Šã€å¥‘ç´„æ›¸é¢ç­‰ã‚’é›»å­ãƒ¡ãƒ¼ãƒ«ï¼ˆPDFï¼‰ã§å—ã‘å–ã‚‹ã“ã¨ã«åŒæ„ã—ãŸè¨˜éŒ²ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚
          </p>

          <div class="consent-copy-box">æ‰¿è«¾ã—ã¾ã™</div>

          <div class="field" id="f_consent" style="margin-bottom:10px;">
            <input type="text" id="consent_input" placeholder="ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„" style="border:2px solid var(--blue); background:#fff;" />
            <div class="error-msg" id="consent_error">ã€Œæ‰¿è«¾ã—ã¾ã™ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„</div>
          </div>

          <div class="field" id="f_sign" style="margin-top:12px;">
            <label>ã”ç½²åï¼ˆãŠåå‰ï¼‰ <span style="color:var(--red); font-size:.85rem;">â€»å¿…é ˆ</span></label>
            <input type="text" id="c_signature" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ" />
            <div class="error-msg">ã”ç½²åï¼ˆãŠåå‰ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            <div class="field-hint">å¥‘ç´„è€…ã”æœ¬äººã®ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
          </div>
        </div>
      </div>
    </div>

    <div class="step" id="step7">
      <div class="complete-screen">
        <div class="complete-icon">ğŸ‰</div>
        <h2 style="margin-bottom:8px;">å—ä»˜å®Œäº†ã—ã¾ã—ãŸ</h2>
        <p style="color:#555;font-weight:700;">
          ã”ç™»éŒ²ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã€Œå¥‘ç´„æ›¸æ§ãˆï¼ˆPDFï¼‰ã€ã‚’ãŠé€ã‚Šã—ã¾ã—ãŸã€‚<br>
          æ‹…å½“è€…ã‚ˆã‚Šã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚
        </p>
      </div>
    </div>

  </div>
  </form>

  <div class="bottom-nav">
    <button class="btn btn-back" onclick="prevStep()" id="btnBack" style="display:none" type="button">æˆ»ã‚‹</button>
    <button class="btn btn-next" onclick="nextStep()" id="btnNext" type="button">æ¬¡ã¸</button>
  </div>

<script>
/* =========================
  â˜…ã“ã“ã ã‘å·®ã—æ›¿ãˆå¿…é ˆâ˜…
========================= */
const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbw.../exec';

/* ========================= */
let currentStep = 1;
let couponApplied = false;

window.addEventListener('load', () => {
  // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åæ˜ 
  const params = new URLSearchParams(location.search);
  const p_id = params.get('case_id');
  if (p_id) {
    const parts = p_id.split('-');
    if (parts.length > 1) {
      document.getElementById('c_case_prefix').value = parts[0];
      document.getElementById('c_case_num').value = parts[1];
    } else {
      document.getElementById('c_case_num').value = p_id;
    }
  }
  if (params.get('emp_id')) document.getElementById('c_emp_id').value = params.get('emp_id');
  if (params.get('name')) document.getElementById('c_name').value = params.get('name');
  if (params.get('tel')) document.getElementById('c_tel').value = params.get('tel');
  if (params.get('email')) document.getElementById('c_email').value = params.get('email');
  if (params.get('address')) document.getElementById('c_address').value = params.get('address');

  bindChoiceUI_('#symptomGrid', 'checkbox');
  bindChoiceUI_('#orderTypeGrid', 'radio', () => toggleRepairMenu());
  bindChoiceUI_('#paymentGrid', 'radio');

  toggleRepairMenu();
  updateUI();
});

function bindChoiceUI_(containerSel, type, onChange) {
  const box = document.querySelector(containerSel);
  if (!box) return;
  const labels = Array.from(box.querySelectorAll('.choice'));

  const refresh = () => {
    labels.forEach(lb => {
      const inp = lb.querySelector('input');
      if (!inp) return;
      lb.classList.toggle('selected', inp.checked);
    });
  };

  labels.forEach(lb => {
    const inp = lb.querySelector('input');
    if (!inp) return;
    inp.addEventListener('change', () => {
      if (type === 'radio') refresh(); else lb.classList.toggle('selected', inp.checked);
      if (typeof onChange === 'function') onChange();
    });
    lb.addEventListener('click', (e) => {
      const i = lb.querySelector('input');
      if (!i) return;
      if (i.type === 'radio') i.checked = true;
      if (i.type === 'checkbox') i.checked = !i.checked;
      i.dispatchEvent(new Event('change', { bubbles:true }));
      e.preventDefault();
    });
  });
  refresh();
}

function toggleRepairMenu() {
  const isRepair = document.querySelector('input[name="order_type"][value="ä¿®ç†"]').checked;
  document.getElementById('repair_options_area').style.display = isRepair ? 'block' : 'none';
}

function changeCount(btn, delta) {
  const row = btn.closest('.repair-item-row');
  const sp = row.querySelector('.count-num');
  let n = parseInt(sp.textContent || '0', 10) + delta;
  if (n < 0) n = 0;
  sp.textContent = String(n);
  row.classList.toggle('active', n > 0);
}

function applyCoupon() {
  const code = document.getElementById('c_coupon_code').value.trim();
  const out = document.getElementById('coupon_result');
  if (code === 'ac2026') {
    couponApplied = true;
    out.textContent = 'ã‚¯ãƒ¼ãƒãƒ³é©ç”¨ï¼š-3,000å††';
    out.className = 'coupon-success';
  } else {
    couponApplied = false;
    out.textContent = 'ç„¡åŠ¹ãªã‚³ãƒ¼ãƒ‰ã§ã™';
    out.className = 'coupon-error';
  }
}

function updateUI() {
  document.querySelectorAll('.step').forEach(e => e.classList.remove('active'));
  const active = document.getElementById('step' + currentStep);
  if (active) active.classList.add('active');

  for (let i = 1; i <= 6; i++) {
    const p = document.getElementById('p' + i);
    if (!p) continue;
    p.className = 'progress-step';
    if (i < currentStep) p.classList.add('done');
    if (i === currentStep) p.classList.add('active');
  }

  const back = document.getElementById('btnBack');
  const next = document.getElementById('btnNext');
  back.style.display = currentStep === 1 ? 'none' : 'block';

  if (currentStep === 6) next.textContent = 'ä¸Šè¨˜ã«åŒæ„ã—ã¦é€ä¿¡';
  else if (currentStep === 7) document.querySelector('.bottom-nav').style.display = 'none';
  else next.textContent = 'æ¬¡ã¸';
}

function setFieldError(fieldId, isError) {
  const f = document.getElementById(fieldId);
  if (!f) return;
  f.classList.toggle('error', !!isError);
}

function validateStep(step) {
  // Step 1: å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯
  if (step === 1) {
    const caseNum = document.getElementById('c_case_num').value.trim();
    const emp = document.getElementById('c_emp_id').value.trim();
    const name = document.getElementById('c_name').value.trim();
    const tel = document.getElementById('c_tel').value.trim();
    const email = document.getElementById('c_email').value.trim();
    const zip = document.getElementById('c_zip').value.trim();
    const addr = document.getElementById('c_address').value.trim();

    setFieldError('f_case', !caseNum);
    setFieldError('f_emp', !emp);
    setFieldError('f_name', !name);
    setFieldError('f_tel', !tel);
    setFieldError('f_email', !email);
    setFieldError('f_zip', !zip);
    setFieldError('f_addr', !addr);

    if (!caseNum || !emp || !name || !tel || !email || !zip || !addr) {
      alert('æœªå…¥åŠ›ã®å¿…é ˆé …ç›®ãŒã‚ã‚Šã¾ã™ã€‚èµ¤æ ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      return false;
    }
  }

  // Step 2: ç´„æ¬¾åŒæ„ãƒã‚§ãƒƒã‚¯
  if (step === 2) {
    if (!document.getElementById('agree_terms_check').checked) {
      alert('ç´„æ¬¾ã®å†…å®¹ã‚’ç¢ºèªã—ã€åŒæ„ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚');
      return false;
    }
  }

  // Step 6: æœ€çµ‚æ‰¿è«¾ãƒã‚§ãƒƒã‚¯
  if (step === 6) {
    const inputConsent = document.getElementById('consent_input').value.trim();
    const signature = document.getElementById('c_signature').value.trim();

    setFieldError('f_consent', inputConsent !== 'æ‰¿è«¾ã—ã¾ã™');
    setFieldError('f_sign', !signature);

    if (inputConsent !== 'æ‰¿è«¾ã—ã¾ã™') {
      document.getElementById('consent_error').style.display = 'block';
      alert('é’æ å†…ã®æ–‡å­—ã€Œæ‰¿è«¾ã—ã¾ã™ã€ã‚’æ­£ç¢ºã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      return false;
    } else {
      document.getElementById('consent_error').style.display = 'none';
    }

    if (!signature) {
      alert('ã”ç½²åï¼ˆãŠåå‰ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      return false;
    }
  }

  return true;
}

function getSelectedSymptoms() {
  const arr = Array.from(document.querySelectorAll('input[name="symptom"]:checked')).map(c => c.value);
  return arr.length ? arr.join('ã€') : 'ãªã—';
}

function getSelectedRepair() {
  const items = [];
  document.querySelectorAll('.repair-item-row').forEach(row => {
    const n = parseInt(row.querySelector('.count-num').textContent || '0', 10);
    if (n > 0) items.push(`${row.dataset.name} x${n}`);
  });

  if (document.getElementById('extra_relocate').checked) items.push('ç§»è¨­è²»ç”¨ï¼ˆåˆ¥é€”è¦‹ç©ï¼‰');
  if (document.getElementById('extra_hanging').checked) items.push('å®¤å¤–æ©Ÿå¤©åŠã‚Šï¼ˆåˆ¥é€”è¦‹ç©ï¼‰');

  return items.length ? items.join('ã€') : 'ï¼ˆé¸æŠãªã—ï¼‰';
}

function calcTotal() {
  let total = 0;
  document.querySelectorAll('.repair-item-row').forEach(row => {
    const n = parseInt(row.querySelector('.count-num').textContent || '0', 10);
    if (n > 0) total += (parseInt(row.dataset.price || '0', 10) * n);
  });
  if (couponApplied) total = Math.max(0, total - 3000);
  return total;
}

function nextStep() {
  if (!validateStep(currentStep)) return;

  // Step 4ã®çµ‚ã‚ã‚Šã§ç¢ºèªç”»é¢ç”Ÿæˆ
  if (currentStep === 4) {
    const prefix = document.getElementById('c_case_prefix').value;
    const num = document.getElementById('c_case_num').value.trim();
    const caseId = `${prefix}-${num}`;

    const d = {
      caseId,
      emp: document.getElementById('c_emp_id').value.trim(),
      name: document.getElementById('c_name').value.trim(),
      tel: document.getElementById('c_tel').value.trim(),
      email: document.getElementById('c_email').value.trim(),
      zip: document.getElementById('c_zip').value.trim(),
      address: document.getElementById('c_address').value.trim(),
      building: document.getElementById('c_building').value.trim(),
      equip: document.getElementById('c_equipment').value,
      sym: getSelectedSymptoms(),
      oType: document.querySelector('input[name="order_type"]:checked').value,
      pay: document.querySelector('input[name="payment_method"]:checked').value
    };

    const repairText = (d.oType === 'ä¿®ç†') ? `<br><span style="font-size:.85rem;color:#666;">â”” ${escapeHtml_(getSelectedRepair())}</span>` : '';
    const disc = couponApplied ? `<br><span style="color:#e65100;font-weight:900;">â€»ã‚¯ãƒ¼ãƒãƒ³é©ç”¨</span>` : '';

    const oTypeLabel = (d.oType === 'åŸå› ç©¶æ˜ä½œæ¥­') ? 'æ•…éšœè¨ºæ–­è²»ç”¨(åŸå› ç©¶æ˜ä½œæ¥­)' : 'ä¿®ç†';

    const html = `
      <div class="confirm-row"><span class="confirm-label">æ¡ˆä»¶ç•ªå·</span><span class="confirm-val">${escapeHtml_(d.caseId)}</span></div>
      <div class="confirm-row"><span class="confirm-label">æ‹…å½“ID</span><span class="confirm-val">${escapeHtml_(d.emp)}</span></div>
      <div class="confirm-row"><span class="confirm-label">ãŠåå‰</span><span class="confirm-val">${escapeHtml_(d.name)}</span></div>
      <div class="confirm-row"><span class="confirm-label">é›»è©±</span><span class="confirm-val">${escapeHtml_(d.tel)}</span></div>
      <div class="confirm-row"><span class="confirm-label">ãƒ¡ãƒ¼ãƒ«</span><span class="confirm-val">${escapeHtml_(d.email)}</span></div>
      <div class="confirm-row"><span class="confirm-label">ä½æ‰€</span><span class="confirm-val">${escapeHtml_(d.zip)}<br>${escapeHtml_(d.address)} ${escapeHtml_(d.building)}</span></div>
      <div class="confirm-row"><span class="confirm-label">å¯¾è±¡æ©Ÿå™¨</span><span class="confirm-val">${escapeHtml_(d.equip)}</span></div>
      <div class="confirm-row"><span class="confirm-label">ç—‡çŠ¶</span><span class="confirm-val">${escapeHtml_(d.sym)}</span></div>
      <div class="confirm-row"><span class="confirm-label">ä½œæ¥­</span><span class="confirm-val" style="color:var(--blue)">${escapeHtml_(oTypeLabel)}${repairText}${disc}</span></div>
      <div class="confirm-row"><span class="confirm-label">æ”¯æ‰•ã„</span><span class="confirm-val">${escapeHtml_(d.pay)}</span></div>
    `;
    document.getElementById('confirmContent').innerHTML = html;
  }

  // Step 5ã®çµ‚ã‚ã‚Šã§é‡‘é¡è¨ˆç®—
  if (currentStep === 5) {
    const oType = document.querySelector('input[name="order_type"]:checked').value;
    const equip = document.getElementById('c_equipment').value;
    const feeInput = document.getElementById('fee_diagnosis');
    const feeLabel = document.getElementById('fee_label');

    let amt = 0;
    if (oType === 'åŸå› ç©¶æ˜ä½œæ¥­') {
      feeLabel.textContent = 'æ•…éšœè¨ºæ–­è²»ç”¨ï¼ˆç¨è¾¼ï¼‰';
      amt = (equip === 'ãƒ«ãƒ¼ãƒ ã‚¨ã‚¢ã‚³ãƒ³') ? 9000 : 15000;
      if (couponApplied) amt = Math.max(0, amt - 3000);
    } else {
      feeLabel.textContent = 'ä¿®ç†ä½œæ¥­è²»ç”¨ï¼ˆç›®å®‰ãƒ»ç¨è¾¼ï¼‰';
      amt = calcTotal();
    }
    feeInput.value = amt.toLocaleString();
  }

  if (currentStep === 6) { doSubmit(); return; }

  currentStep++;
  updateUI();
}

function prevStep() {
  if (currentStep > 1) {
    currentStep--;
    updateUI();
  }
}

function escapeHtml_(s) {
  return String(s || '')
    .replaceAll('&','&amp;').replaceAll('<','&lt;')
    .replaceAll('>','&gt;').replaceAll('"','&quot;')
    .replaceAll("'","&#39;");
}

async function doSubmit() {
  if (!GAS_API_URL || GAS_API_URL.includes('AKfycbw...') || GAS_API_URL.length < 25) {
    alert('ã€é‡è¦ã€‘GASã®URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚GAS_API_URL ã‚’å·®ã—æ›¿ãˆã¦ãã ã•ã„ã€‚');
    return;
  }

  const btn = document.getElementById('btnNext');
  btn.disabled = true;
  btn.textContent = 'é€ä¿¡ä¸­...';

  const prefix = document.getElementById('c_case_prefix').value;
  const num = document.getElementById('c_case_num').value.trim();
  const caseId = `${prefix}-${num}`;

  const rawType = document.querySelector('input[name="order_type"]:checked').value;
  let orderType = rawType;

  if (rawType === 'åŸå› ç©¶æ˜ä½œæ¥­') orderType = 'æ•…éšœè¨ºæ–­è²»ç”¨(åŸå› ç©¶æ˜ä½œæ¥­)';
  if (rawType === 'ä¿®ç†') orderType = `ä¿®ç†ï¼š${getSelectedRepair()}`;

  if (couponApplied) orderType += ' ã€ã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨ã€‘';
  if (document.getElementById('req_sameday').checked) orderType += ' ã€å½“æ—¥å¸Œæœ›ã€‘';

  const payload = {
    contract_id: caseId,
    emp_id: document.getElementById('c_emp_id').value.trim(),
    name: document.getElementById('c_name').value.trim(),
    kana: document.getElementById('c_kana').value.trim(),
    tel: document.getElementById('c_tel').value.trim(),
    email: document.getElementById('c_email').value.trim(),
    zip: document.getElementById('c_zip').value.trim(),
    address: document.getElementById('c_address').value.trim(),
    building: document.getElementById('c_building').value.trim(),
    equipment: document.getElementById('c_equipment').value,
    detail: document.getElementById('c_detail').value.trim(),
    symptoms: Array.from(document.querySelectorAll('input[name="symptom"]:checked')).map(c => c.value),
    order_type: orderType,
    payment_method: document.querySelector('input[name="payment_method"]:checked').value,
    fee_diagnosis: document.getElementById('fee_diagnosis').value.replace(/,/g,''),
    cancel_rule: document.getElementById('cancel_rule').value,
    req_sameday: !!document.getElementById('req_sameday').checked,

    consent_text: document.getElementById('consent_input').value.trim(),
    signature: document.getElementById('c_signature').value.trim()
  };

  try {
    await fetch(GAS_API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(payload)
    });
  } catch (e) {
    console.log('é€ä¿¡å‡¦ç†ï¼šç’°å¢ƒã«ã‚ˆã‚Šå¿œç­”ãŒå–å¾—ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™', e);
  }

  currentStep = 7;
  updateUI();
}
</script>
</body>
</html>
